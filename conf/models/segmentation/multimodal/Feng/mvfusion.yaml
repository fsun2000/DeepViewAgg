# @package models
defaults:
  - segmentation/default

MVFusion:
    # 6.1 M params - 23.8 Mo on the GPU - ~7.2 ko/pixel at training time
    class: Feng.mvfusion.MVFusion_model
    down_conv:
        image:
            down_conv:
                module_name: ADE20KResNet18PPM
                frozen: False
            atomic_pooling:
                module_name: BimodalCSRPool
                mode: max
            view_pooling:
                module_name: GroupBimodalCSRPool
                in_map: 8
                in_mod: 512
                num_groups: 4
                use_mod: False
                gating: True
                group_scaling: True
                map_encoder: DeepSetFeat
                use_num: True
                pool: max
                fusion: concatenation
            fusion:
                module_name: BimodalFusion
                mode: residual
            drop_mod: 0.0
            branching_index: 0
    transformer:
        n_views: 9
        in_map: 9        # mapping feature size
        in_m2f: 20       # M2F one-hot encoded label size
        embed_dim: 256
        hidden_dim: 512
        num_heads: 4
        num_layers: 8
        use_batch_norm: False
        feat_downproj_dim: 16
        dropout: 0.2
        mlp_dropout: 0.0 # final layer dropout
        use_attn_mask: True          # Transformer attention masking
        use_csr_mask: True           # Transformer pixel validity masking
